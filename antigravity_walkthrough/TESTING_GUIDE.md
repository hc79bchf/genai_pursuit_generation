# Gap Analysis Editing - Testing Guide

## Quick Start

1. **Access the application:**
   - Navigate to: http://localhost:3000/dashboard/gap-assessment
   - Login if prompted

2. **Run Gap Analysis:**
   - Ensure you have a pursuit with uploaded RFP file
   - Select a proposal template
   - Click "Run Gap Analysis Agent"
   - Wait for results (~30 seconds)

3. **Edit the Results:**
   - Click the "Edit Results" button (top right of Analysis Results section)
   - You'll enter edit mode with the following capabilities:

## Edit Mode Features

### Editing Gaps
- **Edit existing gaps:** Click into any gap input field and type
- **Add new gap:** Click the "Add Gap" button in the Identified Gaps section
- **Remove gap:** Click the trash icon (ğŸ—‘ï¸) next to any gap

### Editing Search Queries
- **Edit existing queries:** Click into any query input field and type
- **Add new query:** Click the "Add Query" button in the Search Queries section
- **Remove query:** Click the trash icon (ğŸ—‘ï¸) next to any query

### Save or Cancel
- **Save Changes:** Click the green "Save Changes" button (top right)
  - Shows loading spinner while saving
  - Updates are persisted to database
  - Returns to view mode after successful save
- **Cancel:** Click the "Cancel" button
  - Discards all changes
  - Returns to view mode
  - Original results remain unchanged

## Expected Behavior

### View Mode
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Analysis Results         Generated by AI Agent  â”‚
â”‚                          [Edit Results]         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚ Identified Gaps          Search Queries         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚ â”‚ Gap 1        â”‚        â”‚ Query 1      â”‚      â”‚
â”‚ â”‚ Gap 2        â”‚        â”‚ Query 2      â”‚      â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Edit Mode
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Analysis Results         [Cancel] [Save]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚ Identified Gaps [+Add]   Search Queries [+Add]  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”[ğŸ—‘ï¸]    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”[ğŸ—‘ï¸]  â”‚
â”‚ â”‚ Gap 1        â”‚        â”‚ Query 1      â”‚      â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”[ğŸ—‘ï¸]    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”[ğŸ—‘ï¸]  â”‚
â”‚ â”‚ Gap 2        â”‚        â”‚ Query 2      â”‚      â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Test Cases

### Test Case 1: Basic Editing
1. Click "Edit Results"
2. Modify text in first gap field
3. Click "Save Changes"
4. âœ… Verify: Changes are saved and displayed in view mode

### Test Case 2: Adding Items
1. Click "Edit Results"
2. Click "Add Gap" button
3. Type text in new gap field
4. Click "Add Query" button
5. Type text in new query field
6. Click "Save Changes"
7. âœ… Verify: New gap and query appear in results

### Test Case 3: Removing Items
1. Click "Edit Results"
2. Click trash icon next to first gap
3. Click trash icon next to first query
4. Click "Save Changes"
5. âœ… Verify: Removed items no longer appear in results

### Test Case 4: Cancel Changes
1. Click "Edit Results"
2. Make several changes (edit, add, remove)
3. Click "Cancel" button
4. âœ… Verify: All changes are discarded, original results shown

### Test Case 5: Empty State Handling
1. Click "Edit Results"
2. Remove all gaps
3. Remove all queries
4. Click "Save Changes"
5. âœ… Verify: System handles empty arrays gracefully

### Test Case 6: Persistence
1. Make edits and save
2. Refresh the page
3. âœ… Verify: Saved edits persist after page reload

### Test Case 7: Re-running Analysis
1. Make edits and save
2. Click "Run Gap Analysis Agent" again
3. âœ… Verify: New AI-generated results replace manual edits (expected)

## API Testing (Optional)

### Using curl:
```bash
# Get pursuit with gap analysis results
curl -X GET http://localhost:8000/api/v1/pursuits/{pursuit_id} \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"

# Update gap analysis results
curl -X PATCH http://localhost:8000/api/v1/pursuits/{pursuit_id}/gap-analysis \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "gaps": ["New Gap 1", "New Gap 2"],
    "search_queries": ["new query 1", "new query 2"],
    "reasoning": "Updated reasoning"
  }'
```

## Troubleshooting

### Changes not saving
- Check browser console for errors
- Verify backend is running: `docker ps | grep pursuit_backend`
- Check backend logs: `docker logs pursuit_backend --tail 50`

### Edit button not appearing
- Ensure gap analysis has been run (results must exist)
- Check that `pursuit.gap_analysis_result` is not null
- Refresh the page

### UI not updating
- Clear browser cache
- Hard refresh: Cmd+Shift+R (Mac) or Ctrl+Shift+R (Windows)
- Restart frontend: `docker restart pursuit_frontend`

## Known Limitations

1. **No validation:** Empty gaps/queries can be saved
2. **No undo:** Once saved, previous version is lost (unless you cancel before saving)
3. **Re-running overwrites:** Running gap analysis again will replace manual edits
4. **No edit history:** Changes are not tracked with timestamps or user info

## Future Improvements

See the "Future Enhancements" section in [gap_analysis_editing_feature.md](gap_analysis_editing_feature.md) for planned improvements.

---

**Last Updated:** 2025-11-26
**Status:** âœ… Ready for Testing
**Questions?** Check the implementation details in [gap_analysis_editing_feature.md](gap_analysis_editing_feature.md)
